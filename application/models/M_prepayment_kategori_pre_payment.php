<?php class m_prepayment_kategori_pre_payment extends CI_Model { 	public function __construct() 	{ 		parent::__construct(); 		$this->load->model(array('m_core_apps')); 	} 	function gf_load_data($sParam=null) 	{ 		$oParam = $_POST; 		$oData = $sParam === null ? $oParam['Id_Kategori_Pre_Payment'] : $sParam['Id_Kategori_Pre_Payment']; 		$sql = "call sp_query('select nIdKategoriPrePayment, sNamaKategoriPrePayment from tm_prepayment_kategori_pre_payment_h where sStatusDelete is null and nUnitId_fk = ".$this->session->userdata('nUnitId_fk')." and nIdKategoriPrePayment = ".trim($oData)."')"; 		$rs = $this->db->query($sql); 		return $rs->result_array(); 	} 	function gf_transact() 	{ 		$txtIdKategoriPrePayment = $this->input->post('txtIdKategoriPrePayment', TRUE); 		$txtNamaKategoriPrePayment = $this->input->post('txtNamaKategoriPrePayment', TRUE); 		$txtNamaKategoriPrePaymentOld = $this->input->post('txtNamaKategoriPrePaymentOld', TRUE); 		//array		$hideIdKomponenPrePayment = $this->input->post('hideIdKomponenPrePayment', TRUE); 		$hideSeqNo = $this->input->post('hideSeqNo', TRUE); 		$hideMode = $this->input->post('hideMode', TRUE); 		$sReturn = null; 		$UUID = $this->m_core_apps->gf_max_int_id(array("sFieldName" => "nIdKategoriPrePayment", "sTableName" => "tm_prepayment_kategori_pre_payment_h", "sParam" => ""));		if(trim($hideMode) !== "I") 			$UUID = trim($txtIdKategoriPrePayment); 		if(in_array(trim($hideMode), array("I", "U"))) 		{ 			if(strtolower(trim($txtNamaKategoriPrePayment)) !== strtolower(trim($txtNamaKategoriPrePaymentOld))) 			{ 				$sRet = json_decode($this->m_core_apps->gf_check_double_data_in_table(array("sTableName" => "tm_prepayment_kategori_pre_payment_h", "sFieldName" => "sNamaKategoriPrePayment", "sContent" => trim($txtNamaKategoriPrePayment))), TRUE); 				if(intVal($sRet['status']) === 1) 				{ 					$sReturn = json_encode(array("status" => -1, "message" => trim($sRet['message']))); 					return $sReturn; 					exit(0); 				} 			} 		} 		if(in_array(trim($hideMode), array("D"))) 		{ 			$sRet = json_decode($this->m_core_apps->gf_check_foreign_key_use(array("sDatabaseName" => trim($this->db->database), "sFieldName" => "nIdKategoriPRepaYment_fk", "sContent" => trim($txtIdKategoriPrePayment), "sValueLabel" => "Id Kategori_Pre_Payment")), TRUE); 			if(intVal($sRet['status']) === 1) 			{ 				$sReturn = json_encode(array("status" => -1, "message" => trim($sRet['message']))); 				return $sReturn; 				exit(0); 			} 		} 		$sql = null;		if(!in_array(trim($hideMode), array("I"))) 		{			$sql .= "call sp_tm_prepayment_kategori_pre_payment_d('D', ".trim($UUID).", null, null, null, null, ".$this->session->userdata('nUnitId_fk').", '".trim($this->session->userdata('sRealName'))."');"; 		}		$sql .= "call sp_tm_prepayment_kategori_pre_payment_h('".$hideMode."', ".trim($UUID).", '".trim($txtNamaKategoriPrePayment)."', NULL, ".$this->session->userdata('nUnitId_fk').", '".trim($this->session->userdata('sRealName'))."');"; 		for($i=0; $i<count($hideIdKomponenPrePayment); $i++)		{			if(trim($hideIdKomponenPrePayment[$i]) !== "" && trim($hideSeqNo[$i]) !== "")				$sql .= "call sp_tm_prepayment_kategori_pre_payment_d('I', ".trim($UUID).", ".trim($hideIdKomponenPrePayment[$i]).", ".($i+1).", ".trim($hideSeqNo[$i]).", null, ".$this->session->userdata('nUnitId_fk').", '".trim($this->session->userdata('sRealName'))."');"; 		}		$this->db->trans_begin(); 		$this->db->query($sql); 		if ($this->db->trans_status() === FALSE) 		{ 			$this->db->trans_rollback(); 			$sReturn = json_encode(array("status" => -1, "message" => "Failed")); 		} 		else 		{ 			$this->db->trans_commit(); 			$sReturn = json_encode(array("status" => 1, "message" => "Data has been Submitted.")); 		} 		return $sReturn; 	} }